server {
  listen 80;
  server_name localhost;

  root /usr/share/nginx/html;
  index index.html;

  # Serve static assets first under checklistâ€‘plus
  location ^~ /checklist-v2/static/ {
    alias /usr/share/nginx/html/checklistv2/static/;
    # optional: add expires / cache control headers
    try_files $uri =404;
  }

  # Main app routing under /checklist-plus/
  location ^~ /checklist-v2/ {
    alias /usr/share/nginx/html/checklistv2/;   # note trailing slash
    index index.html;
    try_files $uri $uri/ /checklistv2/index.html;
  }

  # optionally, redirect bare /checklist-plus to include trailing slash
  location = /checklist-v2 {
    return 301 /checklist-v2/;
  }

  # PHP-FPM handler: ensure POST is handled correctly
  location ~ ^/checklistv2/api/(.+\.php)(/.*)?$ {
    root /var/www/html;
    fastcgi_pass checklistplusv2-php:9000;
    fastcgi_index index.php;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
    include fastcgi_params;

    # Ensure GET and POST are allowed
    limit_except GET POST {
      deny all;
    }
  }

  # Fallback for API endpoint (if not caught above)
  location /checklistv2/api/ {
    try_files $uri $uri/ /checklistv2/api/index.php?$query_string;
  }
}
